package io.github.makertechno.input.sys;

import ...

public final class ImageProcessor {
    private ImageProcessor() {}
    public static @Nullable ByteArrayOutputStream toByteStream(@NotNull Image image) throws IOException {
        BufferedImage bufferedImage = new BufferedImage(
            image.getWidth(null),
            image.getHeight(null),
            BufferedImage.TYPE_INT_ARGB
        );
        bufferedImage.getGraphics().drawImage(image, 0, 0, null);
        ByteArrayOutputStream byteArrOutS = new ByteArrayOutputStream();
        String format = ImageProcessor.detectImageFormat(bufferedImage);
        if (format != null) {
            ImageIO.write(bufferedImage, format, byteArrOutS);
            return byteArrOutS;
        }
        else return null;
    }
    public static @Nullable String detectImageFormat(BufferedImage bufferedImage) throws IOException {
        ByteArrayOutputStream byteArrOutS = new ByteArrayOutputStream();
        ImageIO.write(bufferedImage, "png", byteArrOutS); // default before test

        Iterator<ImageReader> readers = ImageIO.getImageReaders(ImageIO.createImageInputStream(byteArrOutS));
        if (readers.hasNext()) {
            ImageReader reader = readers.next();
            return reader.getFormatName();
        }
        return null;
    }
}